all:
	CGO_ENABLED=0 GOOS=linux GOARCH=386 go build main.go
	strip --strip-all main
	mv main ./chall
	nasm loader.S -o loader.bin
	python xor.py
	nasm malware.S -o malware.o -fELF32
	ld -dynamic-linker /lib/ld-linux.so.2 -o malchan -lc malware.o -m elf_i386
	strip --strip-all malchan
	rm malware.o
	chmod -x chall
	chmod -x malchan
	chmod -x raindrop.sh
	mv chall ../../distfiles/malware

test:
	qemu-system-i386 -drive format=raw,file=./loader.bin
